---
title: GO基础语法
date: 2026-01-12
updated: 2026-01-13
tags: [GO, 并发]
categories: GO
description: GO语言并发
---

### GO语言并发

#### 基本并发知识

##### 并发和并行

- 并发：并发主要由切换时间片来实现**宏观上**的"同时"运行
- 并行：并行是直接**利用多核实现**多线程的运行，go可以设置使用核数，以发挥多核计算机的能力

##### 进程和线程

- **资源分配和调度**：
  - 进程是程序在操作系统中的一次执行过程，**系统进行资源分配的一个独立单位**。线程是进程的一个执行实体, 是CPU调度的基本单位,它是比进程更小的能独立运行的基本单位。
  - 进程拥有独立的内存空间，同一个进程内部的多个线程共享进程的内存和资源。
- **开销**：进程切换需要保存和恢复整个内存状态，开销较大；线程切换只需保存和恢复少量寄存器，开销较小。
- **独立性**：进程之间互不影响，一个进程崩溃不会影响其他进程；线程共享进程资源，一个线程崩溃可能导致整个进程终止。
- **通信方式**：进程间通信需要使用管道、消息队列、共享内存等机制；线程间可以直接通过共享内存进行通信，但需要同步机制保证数据一致性。

##### 线程和协程

协程是一种**用户态的轻量级线程**，由程序自身控制调度，无需操作系统介入。它通过**协作式多任务**实现并发，适用于高并发和异步I/O场景。线程则是**内核态的执行单元**，由操作系统调度。

- **调度方式**：协程采用用户态协作式调度，线程采用内核态抢占式调度。
- **切换开销**：协程切换开销极低（通常小于1微秒），线程切换开销较高。
- **并发数量**：单线程可管理数万个协程，而线程数量受限于内核资源（通常为数百个）。
- **使用场景**：协程适合I/O密集型和高并发服务，线程适合CPU密集型和多核并行任务。

#### goroutine

`goroutine`其实就是一个超级大的线程池，或者说**协程池**。Go语言中使用`goroutine`非常简单，只需要在调用函数的时候在前面加上go关键字，就可以为一个函数创建一个`goroutine`。

一个`goroutine`必定对应一个函数，可以创建多个`goroutine`去执行相同的函数。

一个简单的例子：

```go
var wg sync.WaitGroup

func hello(i int) {
    defer wg.Done() // goroutine结束就登记-1
    fmt.Println("Hello Goroutine!", i)
}

func main() {
    for i := 0; i < 10; i++ {
        wg.Add(1) // 启动一个goroutine就登记+1
        go hello(i)
    }
    wg.Wait() // 等待所有登记的goroutine都结束
}
```

##### 注意

- 如果主协程退出了，其他任务还执行吗？

- 如果某个协程创建了一个子协程，那么这个协程退出后，其子协程还会执行吗？

